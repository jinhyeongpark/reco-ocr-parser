## 설계 문서 (Design Document)
본 문서는 비정형 OCR 데이터에서 핵심 계량 정보를 추출하기 위한 시스템 설계 및 파싱 전략을 기술합니다.

### 1. 데이터 분석 및 도메인 모델링
제공된 4종의 샘플 데이터를 분석한 결과, 문서의 종류와 형식이 제각각인 비정형성이 가장 큰 특징입니다. 이를 아우르는 공통 도메인을 도출했습니다.

| 샘플 | 핵심 키워드(문서 종류) | 주요 특징 및 노이즈 패턴 | 파싱 대응 전략 |
| :--- | :--- | :--- | :--- |
| **01** | 계량증명서 | 날짜 뒤에 일련번호(`0016`) 혼재 | 정규식 그룹화를 통해 날짜만 추출 |
| **02** | * 계 그 표 * | "계량표" 오타 및 숫자 내 공백(`13 460`) | Alias Map 적용 및 숫자 전처리(공백 제거) |
| **03** | ** 계 량 확 인 서 ** | 한글 시간 포맷(`11시 33분`) 및 저신뢰도 노이즈 | 한글 시간 패턴 매칭 및 Confidence 필터링 |
| **04** | 계 량 증 명 표 | `차량 No.` 키워드 사용 및 괄호 포함 시간 정보 | 키워드 사전 확장 및 괄호 패턴 무시 로직 |

### 2. 핵심 파싱 전략 (Parsing Strategy)
OCR 엔진의 한계를 극복하고 데이터 신뢰도를 높이기 위해 다음과 같은 전략을 사용합니다.

**신뢰도(Confidence) 기반 처리 로직**
- `Confidence ≥ 0.9` (High): 검증 없이 데이터 저장.
- `0.6 ≤ Confidence < 0.9` (Medium): 정규식 매칭 실패 시 2차 전처리 시도.
- `Confidence < 0.6` (Low): 'Needs Review' 플래그(true)를 부여하고 별도 로그 기록.

**용어 별칭 사전(Alias Map) 활용**
- 비정형 키워드(차량번호, 차번호, 차량 No.)를 시스템 표준 필드명(carNumber)으로 매핑하여 확장성 확보

**정규표현식 및 전처리 기법**
1. 키워드 유연성 확보: `\s*` 패턴을 사용하여 `회 사 명`, `제 품 명` 등 단어 사이의 가변적인 공백에 대응
2. 숫자 데이터 정규화: `13 460`, `14,230` 등 공백이나 콤마(`,`)가 포함된 문자열에서 순수 숫자만 추출하여 `Double` 타입으로 변환
3. 용어 별칭 사전(Alias Map):
    - 문서 종류: `증명서`, `확인서`, `계 그 표` → `WeightTicketType`으로 표준화
    - 중량 종류: `공차중량`, `차중량` → `tareWeight`로 표준화
4. 날짜 포맷 정제: `2026-02-02-00004`처럼 구분자가 중첩된 경우, 상위 10자리만 취하여 `LocalDate`로 파싱

### 3. 시스템 아키텍처 및 유지보수
- 관심사의 분리: 파싱 로직(Service), 데이터 검증(Domain), 외부 설정(YAML)을 철저히 분리하여 양식이 추가되더라도 기존 코드를 최소한으로 수정하도록 설계
- 로깅 및 추적: DEBUG 레벨 로그를 통해 원본 텍스트와 추출된 값, 그리고 Confidence 점수를 남겨 파싱 실패 원인을 즉각 파악
